{% load static %}
<div id="profileModal" class="fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
    <div class="bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl w-full max-w-md transform transition-all duration-300 scale-95 hover:scale-100">
        <!-- En-tÃªte -->
        <div class="flex justify-between items-center border-b border-gray-700 p-6">
            <h3 class="text-xl font-bold text-green-400">
                <i class="fas fa-user-circle mr-2"></i>Mon Profil
            </h3>
            <button onclick="closeModal('profileModal')" 
                    class="text-gray-400 hover:text-white hover:bg-gray-700 rounded-full p-2 transition duration-200">
                <i class="fas fa-times text-lg"></i>
            </button>
        </div>
         
        <!-- Contenu -->
        <div class="p-6">
            <form id="profileForm" method="post" 
                action="{% url 'projets:profile_update' %}" 
                enctype="multipart/form-data"
                class="space-y-6">

                {% csrf_token %}
                
                <!-- Avatar -->
                <div class="text-center">
                    <label class="block text-sm font-medium text-gray-300 mb-3">Photo de profil</label>
                    <div class="flex flex-col items-center space-y-4">
                        <!-- PrÃ©visualisation -->
                        <div class="relative">
                            <img id="avatarPreview" 
                                src="{{ user.profile.avatar.url }}" 
                                class="w-24 h-24 rounded-full border-4 border-green-500 object-cover shadow-lg"
                                onerror="this.src='{% static 'images/default_avatar.png' %}'">
                            <div class="absolute -bottom-2 -right-2 bg-green-500 rounded-full p-1 shadow-lg">
                                <i class="fas fa-camera text-white text-xs"></i>
                            </div>
                        </div>
                        
                        <!-- Input fichier masquÃ© -->
                        <input type="file" 
                            name="avatar" 
                            id="avatarInput" 
                            class="hidden" 
                            accept="image/*">
                        
                        <!-- Bouton dÃ©clencheur -->
                        <button
                            hx-get="{% url 'projets:avatar_upload_modal' %}"
                            hx-target="#modals-container"
                            hx-swap="innerHTML"
                            class="bg-gradient-to-r from-green-600 to-green-500 text-white px-4 py-2 rounded-lg hover:from-green-500 hover:to-green-400 transition duration-200 font-semibold">
                            <i class="fas fa-camera mr-2"></i>Changer la photo
                        </button>
                    </div>
                </div>
                
                <!-- Informations utilisateur -->
                <div class="space-y-4">
                    <!-- Nom complet -->
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">
                            <i class="fas fa-user mr-2 text-blue-400"></i>Nom complet
                        </label>
                        <input type="text" 
                               name="full_name" 
                               value="{{ user.get_full_name }}" 
                               class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                               placeholder="Votre nom complet">
                    </div>
                    
                    <!-- Email -->
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">
                            <i class="fas fa-envelope mr-2 text-yellow-400"></i>Adresse email
                        </label>
                        <input type="email" 
                               name="email" 
                               value="{{ user.email }}" 
                               class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition"
                               placeholder="votre@email.com">
                    </div>
                </div>
                
                <!-- Boutons d'action -->
                <div class="flex space-x-3 pt-4">
                    <button type="button" 
                            onclick="closeModal('profileModal')" 
                            class="flex-1 bg-gray-700 text-gray-300 px-4 py-3 rounded-lg hover:bg-gray-600 hover:text-white transition duration-200 border border-gray-600 font-semibold">
                        <i class="fas fa-times mr-2"></i>Annuler
                    </button>
                    <button type="submit" 
                            id="submitProfileBtn" 
                            class="flex-1 bg-gradient-to-r from-green-600 to-green-500 text-white px-4 py-3 rounded-lg hover:from-green-500 hover:to-green-400 transition duration-200 font-semibold shadow-lg">
                        <i class="fas fa-save mr-2"></i>Enregistrer
                    </button>
                </div>
            </form>
            
            <!-- Lien changement mot de passe -->
            <div class="mt-6 pt-6 border-t border-gray-700 text-center">
                <button 
                    hx-get="{% url 'projets:password_modal' %}"
                    hx-target="#modals-container"
                    hx-swap="innerHTML"
                    class="text-green-400 hover:text-green-300 transition duration-200 font-medium group">
                    <i class="fas fa-key mr-2 group-hover:animate-bounce"></i> 
                    Changer le mot de passe
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// console.log('ðŸŽ¯ Script INTERNE profile_modal exÃ©cutÃ©');

// // Initialisation immÃ©diate
// document.addEventListener('DOMContentLoaded', function() {
//     console.log('ðŸ  DOMContentLoaded dans la modal');
//     setupAvatarButton();
// });

// // function setupAvatarButton() {
// //     const changeBtn = document.getElementById('changeAvatarBtn');
// //     const avatarInput = document.getElementById('avatarInput');
    
// //     console.log('Dans modal - changeBtn:', changeBtn);
// //     console.log('Dans modal - avatarInput:', avatarInput);
    
// //     if (changeBtn && avatarInput) {
// //         changeBtn.addEventListener('click', function() {
// //             console.log('âœ… Clic dÃ©tectÃ© (script interne)');
// //             avatarInput.click();
// //         });
// //     }
// // }

// // // Gestionnaire pour le bouton "Changer"
// // document.addEventListener('DOMContentLoaded', function() {
// //     const setupProfileModal = function() {
// //         console.log('ðŸ”§ setupProfileModal executÃ©e');
        
// //         const changeAvatarBtn = document.getElementById('changeAvatarBtn');
// //         const avatarInput = document.getElementById('avatarInput');
        
// //         console.log('changeAvatarBtn:', changeAvatarBtn);
// //         console.log('avatarInput:', avatarInput);

// //         if (changeAvatarBtn && avatarInput) {
// //             console.log('âœ… Ã‰lÃ©ments trouvÃ©s, ajout des Ã©vÃ©nements...');
            
// //             changeAvatarBtn.addEventListener('click', function() {
// //                 console.log('ðŸŽ¯ Bouton "Changer" cliquÃ©!');
// //                 avatarInput.click();
// //             });
// //             // GÃ©rer le changement de fichier
// //             avatarInput.addEventListener('change', function(e) {
// //                 if (this.files && this.files[0]) {
// //                     const reader = new FileReader();
// //                     reader.onload = function(e) {
// //                         avatarPreview.src = e.target.result;
// //                         // Ajouter une animation de confirmation
// //                         avatarPreview.classList.add('ring-2', 'ring-green-400');
// //                         setTimeout(() => {
// //                             avatarPreview.classList.remove('ring-2', 'ring-green-400');
// //                         }, 1000);
// //                     };
// //                     reader.readAsDataURL(this.files[0]);
// //                 }
// //             });
// //         }

// //         // Animation de soumission du formulaire
// //         if (profileForm) {
// //             profileForm.addEventListener('submit', function() {
// //                 const submitBtn = document.getElementById('submitProfileBtn');
// //                 if (submitBtn) {
// //                     submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Enregistrement...';
// //                     submitBtn.disabled = true;
// //                 }
// //             });
// //         }
// //     };
    
// //     // ExÃ©cuter maintenant si la modale est dÃ©jÃ  dans le DOM
// //     if (document.getElementById('profileModal')) {
// //         console.log('Setup profile modal');
// //         setupProfileModal();
// //     }
    
// //     // Ã‰couter les Ã©vÃ©nements HTMX pour les modales chargÃ©es dynamiquement
// //     document.body.addEventListener('htmx:afterSwap', function(event) {
// //         if (event.detail.target.id === 'modals-container' && 
// //             event.detail.target.innerHTML.includes('profileModal')) {
// //             setTimeout(setupProfileModal, 50);
// //         }
// //     });
// // });

// // Fonction de fermeture avec animation
// function closeProfileModal() {
//     const modal = document.getElementById('profileModal');
//     if (modal) {
//         modal.classList.add('opacity-0', 'scale-95');
//         setTimeout(() => {
//             modal.remove();
//         }, 300);
//     }
// }

</script>