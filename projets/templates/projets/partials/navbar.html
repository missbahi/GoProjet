<nav class="bg-gray-800 border-b border-gray-700">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">
      <!-- Logo et navigation principale -->
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <a href="{% url 'home' %}" class="flex items-center">
            <i class="fas fa-building text-indigo-400 text-2xl mr-2"></i>
            <span class="text-white font-bold text-xl">MEGAPERFORMANCE</span>
          </a>
        </div>
        <div class="hidden md:block ml-10">
          <div class="flex space-x-4">
            <a href="{% url 'home' %}" 
               class="{% if request.resolver_match.url_name == 'accueil' %}bg-gray-900 text-white{% else %}text-gray-300 hover:bg-gray-700 hover:text-white{% endif %} px-3 py-2 rounded-md text-sm font-medium">
              <i class="fas fa-tachometer-alt mr-1"></i> Tableau de bord
            </a>
            <a href="{% url 'projets:liste_projets' %}" 
               class="{% if 'projets' in request.resolver_match.url_name %}bg-gray-900 text-white{% else %}text-gray-300 hover:bg-gray-700 hover:text-white{% endif %} px-3 py-2 rounded-md text-sm font-medium">
              <i class="fas fa-project-diagram mr-1"></i> Projets
            </a>
            <a href="{% url 'projets:calendrier' %}" 
               class="{% if request.resolver_match.url_name == 'calendrier' %}bg-gray-900 text-white{% else %}text-gray-300 hover:bg-gray-700 hover:text-white{% endif %} px-3 py-2 rounded-md text-sm font-medium">
              <i class="fas fa-calendar-alt mr-1"></i> Calendrier
            </a>
          </div>
        </div>
      </div>

      <!-- Section droite (recherche, notifications, profil) -->
      <div class="hidden md:block">
        <div class="ml-4 flex items-center md:ml-6">
          <!-- Barre de recherche -->
          <div class="relative mr-4">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i class="fas fa-search text-gray-400"></i>
            </div>
            <input type="text" 
                   class="block w-full pl-10 pr-3 py-2 border border-gray-600 rounded-md bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" 
                   placeholder="Rechercher...">
          </div>

          <!-- Notifications -->
          <div class="ml-3 relative">
            <button id="notificationBtn" class="p-1 rounded-full text-gray-400 hover:text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-white">
              <span class="sr-only">Notifications</span>
              <i class="fas fa-bell h-6 w-6"></i>
              {% if nb_notifications > 0 %}
              <span class="absolute top-0 right-0 block h-2 w-2 rounded-full bg-red-400"></span>
              {% endif %}
            </button>
          </div>

          <!-- Menu profil -->
          <div class="ml-3 relative">
            <div>
              <button id="userMenuBtn" class="max-w-xs bg-gray-800 rounded-full flex items-center text-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-white">
                <span class="sr-only">Menu utilisateur</span>
                <img class="h-8 w-8 rounded-full" src="{{ user.profile.avatar.url }}" alt="Photo de profil">
                <span class="ml-2 text-gray-300 text-sm hidden md:inline">{{ user.username }}</span>
                <i class="fas fa-chevron-down ml-1 text-gray-400 text-xs"></i>
              </button>
            </div>
            
            <!-- Dropdown profil -->
            <div id="userDropdown" class="hidden origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-gray-700 ring-1 ring-black ring-opacity-5 focus:outline-none z-50">
              <a href="{% url 'projets:profile' %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-600">
                <i class="fas fa-user-circle mr-2"></i> Profil
              </a>
              <a href="{% url 'projets:liste_notifications' %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-600">
                <i class="fas fa-bell mr-2"></i> Notifications
                {% if nb_notifications > 0 %}
                <span class="ml-auto inline-block px-2 py-0.5 text-xs rounded-full bg-red-500 text-white">
                  {{ nb_notifications }}
                </span>
                {% endif %}
              </a>
              {% if user.is_superuser %}
              <a href="{% url 'admin:index' %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-600">
                <i class="fas fa-cog mr-2"></i> Administration
              </a>
              {% endif %}
              <div class="border-t border-gray-600"></div>
              <form method="post" action="{% url 'logout' %}">
                {% csrf_token %}
                <button type="submit" class="w-full text-left block px-4 py-2 text-sm text-gray-300 hover:bg-gray-600">
                  <i class="fas fa-sign-out-alt mr-2"></i> Déconnexion
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Menu mobile -->
      <div class="-mr-2 flex md:hidden">
        <button id="mobileMenuBtn" type="button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white">
          <span class="sr-only">Menu principal</span>
          <i class="fas fa-bars" id="mobileMenuIcon"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Menu mobile (dépliant) -->
  <div id="mobileMenu" class="hidden md:hidden">
    <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
      <a href="{% url 'home' %}" class="{% if request.resolver_match.url_name == 'accueil' %}bg-gray-900 text-white{% else %}text-gray-300 hover:bg-gray-700 hover:text-white{% endif %} block px-3 py-2 rounded-md text-base font-medium">
        <i class="fas fa-tachometer-alt mr-2"></i> Tableau de bord
      </a>
      <a href="{% url 'projets:liste_projets' %}" class="{% if 'projets' in request.resolver_match.url_name %}bg-gray-900 text-white{% else %}text-gray-300 hover:bg-gray-700 hover:text-white{% endif %} block px-3 py-2 rounded-md text-base font-medium">
        <i class="fas fa-project-diagram mr-2"></i> Projets
      </a>
      <a href="{% url 'projets:calendrier' %}" class="{% if request.resolver_match.url_name == 'calendrier' %}bg-gray-900 text-white{% else %}text-gray-300 hover:bg-gray-700 hover:text-white{% endif %} block px-3 py-2 rounded-md text-base font-medium">
        <i class="fas fa-calendar-alt mr-2"></i> Calendrier
      </a>
    </div>
    <div class="pt-4 pb-3 border-t border-gray-700">
      <div class="flex items-center px-5">
        <div class="flex-shrink-0">
          <img class="h-10 w-10 rounded-full" src="{{ user.profile.avatar.url }}" alt="">
        </div>
        <div class="ml-3">
          <div class="text-base font-medium text-white">{{ user.get_full_name }}</div>
          <div class="text-sm font-medium text-gray-400">{{ user.email }}</div>
        </div>
      </div>
      <div class="mt-3 px-2 space-y-1">
        <a href="{% url 'projets:profile' %}" class="block px-3 py-2 rounded-md text-base font-medium text-gray-400 hover:text-white hover:bg-gray-700">
          <i class="fas fa-user-circle mr-2"></i> Profil
        </a>
        <a href="{% url 'projets:liste_notifications' %}" class="block px-3 py-2 rounded-md text-base font-medium text-gray-400 hover:text-white hover:bg-gray-700">
          <i class="fas fa-bell mr-2"></i> Notifications
          {% if nb_notifications > 0 %}
          <span class="ml-1 inline-block px-1.5 py-0.5 text-xs rounded-full bg-red-500 text-white">
            {{ nb_notifications }}
          </span>
          {% endif %}
        </a>
        <form method="post" action="{% url 'logout' %}">
          {% csrf_token %}
          <button type="submit" class="w-full text-left block px-3 py-2 rounded-md text-base font-medium text-gray-400 hover:text-white hover:bg-gray-700">
            <i class="fas fa-sign-out-alt mr-2"></i> Déconnexion
          </button>
        </form>
      </div>
    </div>
  </div>
</nav>

<script>
// Gestion du menu mobile
document.getElementById('mobileMenuBtn').addEventListener('click', function() {
  const menu = document.getElementById('mobileMenu');
  const icon = document.getElementById('mobileMenuIcon');
  
  menu.classList.toggle('hidden');
  if (menu.classList.contains('hidden')) {
    icon.classList.remove('fa-times');
    icon.classList.add('fa-bars');
  } else {
    icon.classList.remove('fa-bars');
    icon.classList.add('fa-times');
  }
});

// Gestion du dropdown utilisateur
document.getElementById('userMenuBtn').addEventListener('click', function() {
  document.getElementById('userDropdown').classList.toggle('hidden');
});

// Fermer les menus quand on clique ailleurs
document.addEventListener('click', function(e) {
  if (!e.target.closest('#userMenuBtn') && !e.target.closest('#userDropdown')) {
    document.getElementById('userDropdown').classList.add('hidden');
  }
  if (!e.target.closest('#mobileMenuBtn') && !e.target.closest('#mobileMenu')) {
    document.getElementById('mobileMenu').classList.add('hidden');
    document.getElementById('mobileMenuIcon').classList.remove('fa-times');
    document.getElementById('mobileMenuIcon').classList.add('fa-bars');
  }
});
</script>